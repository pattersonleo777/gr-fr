<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Rally App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Load GLTFLoader for 3D model loading -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        /* Custom font import for aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        .font-inter {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the draggable header */
        #rallyHeader {
            min-height: 60px; /* Minimum header height */
            height: 80px; /* Default height */
            user-select: none;
            transition: height 0.3s ease-out;
        }
        #resizeHandle {
            cursor: ns-resize;
        }
        /* Style for the sidebar transition */
        #rallySidebar {
            transition: width 0.3s ease, min-width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-900 font-inter p-4 sm:p-6 md:p-8 min-h-screen flex justify-center">
    <!-- Application Container (Handles the two main views) -->
    <div id="appContainer" class="w-full max-w-6xl">
        <!-- Home View: Existing Banners and 3D Visualization -->
        <div id="homeView" class="w-full space-y-6">
            <!-- Banner 1: Gods Rods -->
            <div class="relative overflow-hidden rounded-2xl shadow-2xl h-80 sm:h-96 md:h-[480px] bg-gradient-to-br from-gray-800 to-gray-900">
                <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col items-center justify-center text-white p-4 text-center">
                    <h1 class="text-4xl sm:text-6xl md:text-7xl lg:text-8xl font-black uppercase tracking-wider mb-2 drop-shadow-lg">
                        Gods Rods
                    </h1>
                    <p class="text-lg sm:text-xl md:text-2xl font-light mb-8 drop-shadow-md">
                        Premium Performance
                    </p>
                    <a href="#" class="inline-block px-8 py-3 bg-white text-gray-900 font-bold uppercase rounded-full shadow-lg transition duration-300 hover:bg-gray-200 text-sm sm:text-base">
                        Shop Now
                    </a>
                </div>
            </div>
            
            <!-- Banner 2: Fantasy Rally (3JS Visualization) -->
            <div id="fantasyRallyBanner" class="relative overflow-hidden rounded-2xl shadow-2xl h-80 sm:h-96 md:h-[480px] bg-gray-900 flex flex-col items-center justify-center">
                <!-- 3D Canvas Container - Z-0 ensures it is the background -->
                <div id="canvasContainer" class="absolute inset-0 z-0">
                    <canvas id="rally3DCanvas" class="w-full h-full"></canvas>
                </div>
                <!-- Dark Overlay and Text - Z-10 ensures it is on top of the 3D scene -->
                <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col items-center justify-center text-white p-4 text-center z-10">
                    <h1 class="text-4xl sm:text-6xl md:text-7xl lg:text-8xl font-black uppercase tracking-wider mb-2 drop-shadow-lg">
                        Fantasy Rally
                    </h1>
                    <p class="text-lg sm:text-xl md:text-2xl font-light mb-8 drop-shadow-md">
                        Ultimate Racing Experience
                    </p>
                    <button id="enterRallyButton" class="inline-block px-8 py-3 bg-white text-gray-900 font-bold uppercase rounded-full shadow-lg transition duration-300 hover:bg-gray-200 text-sm sm:text-base">
                        Enter Rally
                    </button>
                </div>
            </div>
            
            <!-- 3D Model Dissection Explanation Card -->
            <div class="bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-xl text-gray-200 mt-6 border border-gray-700">
                <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-cyan-400">3D Model Dissection Theory (See Visualization Above)</h2>
                <p class="text-base sm:text-lg mb-4 leading-relaxed">
                    The rotating model above demonstrates 3D rendering. Achieving a true dissectible car model from a single 2D image requires two distinct stages: converting the image to geometry, and then slicing that geometry into separate components.
                </p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-white">1. 2D to 3D Conversion üöó</h3>
                        <p class="text-sm sm:text-base mb-3 text-gray-300">
                            The fastest method is using AI Image-to-3D Generators (e.g., Hyper3D, Meshy) to create an initial 3D mesh (OBJ/GLB) by estimating depth. For the internal detail necessary for dissection, manual modeling in professional software like Blender or Maya is highly recommended.
                        </p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-white">2. 3D Model Dissection üõ†Ô∏è</h3>
                        <p class="text-sm sm:text-base mb-3 text-gray-300">
                            Once the model exists, 3D software (Blender) is used to split the single object into separate components. Tools like the Bisect Tool or Boolean operations cut the main mesh, allowing parts (e.g., body panel, engine) to be moved or "exploded" away to reveal the inner structure.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Rally App View (Initially hidden) -->
        <div id="rallyView" class="hidden w-full h-[85vh] flex flex-col overflow-hidden rounded-2xl shadow-2xl bg-gray-800">
            <!-- Resizable Header -->
            <div id="rallyHeader" class="bg-gray-900 text-white flex-shrink-0 relative">
                <div class="p-3 flex justify-between items-center h-full">
                    <!-- Left: User & Cash -->
                    <div class="flex items-center space-x-4">
                        <div class="text-xl font-mono text-green-400">$<span id="cashBalance">12,345</span></div>
                        <div class="text-lg text-gray-300 font-semibold">User: <span id="userNamePlaceholder">RallyDriver_01</span></div>
                    </div>
                    <!-- Center: Title & Sidebar Toggle -->
                    <div class="text-2xl font-bold uppercase tracking-wider text-fuchsia-400 flex items-center">
                        <button id="toggleSidebar" class="p-2 mr-3 bg-gray-700 hover:bg-gray-600 rounded-full transition duration-150">
                            <!-- Toggle Icon (Hamburger / Close) -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                        FANTASY RALLY HUB
                    </div>
                    <!-- Right: Friends Online -->
                    <div class="flex items-center text-lg text-yellow-400">
                        <span id="friendsOnline">15</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-1" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-4.42 3.59-8 8-8 4.41 0 8 3.58 8 8 0 4.41-3.59 8-8 8zM9 13c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM9 9h6v1H9V9z"/>
                        </svg>
                    </div>
                </div>
                
                <!-- Resize Handle -->
                <div id="resizeHandle" class="absolute bottom-0 left-0 w-full h-2 bg-gray-700 hover:bg-cyan-500 transition duration-150"></div>
            </div>
            
            <!-- Main Content Area (Sidebar + Canvas) -->
            <div class="flex flex-1 overflow-hidden">
                <!-- Sidebar -->
                <div id="rallySidebar" class="bg-gray-700 min-w-0 w-0 md:w-1/4 max-w-xs flex-shrink-0 text-white overflow-y-auto p-0 md:p-4 transition-all duration-300">
                    <h3 class="text-xl font-bold mb-4 text-cyan-400 border-b border-gray-600 pb-2 hidden md:block" id="sidebarTitle">AI Model Integration</h3>
                    <div class="space-y-4">
                        <!-- Input for URLs -->
                        <div>
                            <label for="addUrl" class="block text-sm font-medium mb-1">Add 3D Model URL (.glb/.gltf):</label>
                            <input type="url" id="addUrl" placeholder="https://example.com/model.glb" class="w-full p-2 rounded bg-gray-600 border border-gray-500 text-white placeholder-gray-400 focus:ring-cyan-500 focus:border-cyan-500">
                            <button id="addAssetBtn" class="w-full mt-2 py-2 bg-cyan-600 hover:bg-cyan-700 rounded font-semibold transition">Load 3D Model</button>
                        </div>
                        
                        <!-- Sample Models -->
                        <div class="p-3 bg-gray-600 rounded-lg">
                            <h4 class="font-bold text-lg mb-2">Sample Models</h4>
                            <button id="loadSampleCar" class="w-full mt-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">Load Sample Car</button>
                        </div>
                        
                        <!-- Replicate API Mock -->
                        <div class="p-3 bg-gray-600 rounded-lg">
                            <h4 class="font-bold text-lg mb-1">Replicate API</h4>
                            <p class="text-sm text-gray-300">Generate terrain textures or 3D assets on-demand.</p>
                            <button onclick="alert('Mock: Initiating Replicate API call...')" class="w-full mt-2 py-1 bg-green-600 hover:bg-green-700 rounded text-sm transition">Generate Texture</button>
                        </div>
                        
                        <!-- Krea AI Mock -->
                        <div class="p-3 bg-gray-600 rounded-lg">
                            <h4 class="font-bold text-lg mb-1">Krea AI / Popup Browser</h4>
                            <p class="text-sm text-gray-300">Access Krea's real-time generation tools in a popup window.</p>
                            <button onclick="window.open('https://krea.ai', '_blank')" class="w-full mt-2 py-1 bg-fuchsia-600 hover:bg-fuchsia-700 rounded text-sm transition">Open Krea Popup</button>
                        </div>
                        
                        <!-- Leonardo AI Mock -->
                        <div class="p-3 bg-gray-600 rounded-lg">
                            <h4 class="font-bold text-lg mb-1">Leonardo AI / Popup Browser</h4>
                            <p class="text-sm text-gray-300">Use Leonardo for high-fidelity car part design prompts.</p>
                            <button onclick="window.open('https://leonardo.ai', '_blank')" class="w-full mt-2 py-1 bg-indigo-600 hover:bg-indigo-700 rounded text-sm transition">Open Leonardo Popup</button>
                        </div>
                    </div>
                </div>
                
                <!-- Main Canvas Area -->
                <div class="flex-1 bg-gray-900 relative p-1 md:p-4 flex flex-col">
                    <h2 class="text-xl text-white font-semibold mb-2">3D Rally Design Workspace</h2>
                    <canvas id="mainRallyCanvas" class="flex-1 bg-gray-700 border-4 border-dashed border-gray-600 rounded-lg"></canvas>
                    
                    <div class="mt-4 flex justify-between items-center flex-wrap gap-2">
                        <button id="copyCanvasBtn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-150">
                            Copy Canvas Image
                        </button>
                        <button id="resetViewBtn" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold rounded-lg transition duration-150">
                            Reset Camera
                        </button>
                        <p class="text-sm text-gray-400">Drag to rotate ‚Ä¢ Scroll to zoom</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- Global Variables and Setup ---
        const homeView = document.getElementById('homeView');
        const rallyView = document.getElementById('rallyView');
        const enterRallyButton = document.getElementById('enterRallyButton');
        
        const rallyHeader = document.getElementById('rallyHeader');
        const resizeHandle = document.getElementById('resizeHandle');
        const rallySidebar = document.getElementById('rallySidebar');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const mainRallyCanvas = document.getElementById('mainRallyCanvas');
        
        // Initial state
        let sidebarOpen = true;
        let headerResizing = false;
        const MIN_HEADER_HEIGHT = 60;
        const MAX_HEADER_HEIGHT = 200;
        
        // Main 3D scene variables
        let mainScene, mainCamera, mainRenderer, mainModel;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        
        // --- View Navigation ---
        enterRallyButton.addEventListener('click', () => {
            homeView.classList.add('hidden');
            rallyView.classList.remove('hidden');
            initMain3D();
        });
        
        // --- three.js Visualization for Home Banner ---
        function initHome3D() {
            const container = document.getElementById('fantasyRallyBanner');
            const canvas = document.getElementById('rally3DCanvas');
            if (!container || !canvas || typeof THREE === 'undefined') return;
            
            const scene = new THREE.Scene();
            scene.background = null;
            
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 4;
            
            const renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                alpha: true,
                antialias: true
            });
            renderer.setSize(container.clientWidth, container.clientHeight);
            
            const carGroup = new THREE.Group();
            
            // Car body
            const bodyGeometry = new THREE.BoxGeometry(3.5, 1, 1.5);
            const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xcc0000, shininess: 150 });
            const carBody = new THREE.Mesh(bodyGeometry, bodyMaterial);
            carBody.position.y = 0.5;
            carGroup.add(carBody);
            
            // Car cabin
            const cabinGeometry = new THREE.BoxGeometry(1.5, 0.8, 1.2);
            const cabinMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff, transparent: true, opacity: 0.8 });
            const carCabin = new THREE.Mesh(cabinGeometry, cabinMaterial);
            carCabin.position.set(0.5, 1.3, 0);
            carGroup.add(carCabin);
            
            // Wheels
            const wheelGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.3, 16);
            const wheelMaterial = new THREE.MeshPhongMaterial({ color: 0x111111 });
            const wheelPositions = [
                [-1.5, 0.1, 0.8], [1.5, 0.1, 0.8],
                [-1.5, 0.1, -0.8], [1.5, 0.1, -0.8]
            ];
            
            wheelPositions.forEach(pos => {
                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                wheel.position.set(pos[0], pos[1], pos[2]);
                wheel.rotation.z = Math.PI / 2;
                carGroup.add(wheel);
            });
            
            scene.add(carGroup);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 3);
            directionalLight.position.set(5, 5, 5).normalize();
            scene.add(directionalLight);
            
            function animate() {
                requestAnimationFrame(animate);
                carGroup.rotation.y += 0.005;
                renderer.render(scene, camera);
            }
            
            function onWindowResize() {
                const newWidth = container.clientWidth;
                const newHeight = container.clientHeight;
                camera.aspect = newWidth / newHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(newWidth, newHeight);
            }
            
            window.addEventListener('resize', onWindowResize, false);
            animate();
        }
        
        // --- Main 3D Canvas Functions ---
        function initMain3D() {
            const canvas = document.getElementById('mainRallyCanvas');
            
            mainScene = new THREE.Scene();
            mainScene.background = new THREE.Color(0x1f2937);
            
            mainCamera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            mainCamera.position.set(0, 2, 5);
            mainCamera.lookAt(0, 0, 0);
            
            mainRenderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            mainRenderer.setSize(canvas.clientWidth, canvas.clientHeight);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 2);
            mainScene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 10, 7.5);
            mainScene.add(directionalLight);
            
            // Grid helper
            const gridHelper = new THREE.GridHelper(20, 20, 0x444444, 0x222222);
            mainScene.add(gridHelper);
            
            // Create a default placeholder model
            createPlaceholderModel();
            
            // Mouse controls
            setupMouseControls();
            
            // Handle window resize
            window.addEventListener('resize', onMainCanvasResize);
            
            animateMain();
        }
        
        function createPlaceholderModel() {
            // Create a simple car placeholder
            const group = new THREE.Group();
            
            const bodyGeom = new THREE.BoxGeometry(2, 0.5, 1);
            const bodyMat = new THREE.MeshPhongMaterial({ color: 0x3b82f6 });
            const body = new THREE.Mesh(bodyGeom, bodyMat);
            body.position.y = 0.25;
            group.add(body);
            
            const cabinGeom = new THREE.BoxGeometry(1, 0.4, 0.8);
            const cabinMat = new THREE.MeshPhongMaterial({ color: 0x60a5fa });
            const cabin = new THREE.Mesh(cabinGeom, cabinMat);
            cabin.position.set(0.3, 0.7, 0);
            group.add(cabin);
            
            if (mainModel) mainScene.remove(mainModel);
            mainModel = group;
            mainScene.add(mainModel);
        }
        
        function setupMouseControls() {
            const canvas = document.getElementById('mainRallyCanvas');
            
            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.offsetX, y: e.offsetY };
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (isDragging && mainModel) {
                    const deltaX = e.offsetX - previousMousePosition.x;
                    const deltaY = e.offsetY - previousMousePosition.y;
                    
                    mainModel.rotation.y += deltaX * 0.01;
                    mainModel.rotation.x += deltaY * 0.01;
                    
                    previousMousePosition = { x: e.offsetX, y: e.offsetY };
                }
            });
            
            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            canvas.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            // Zoom with mouse wheel
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const zoomSpeed = 0.1;
                mainCamera.position.z += e.deltaY * zoomSpeed * 0.01;
                mainCamera.position.z = Math.max(2, Math.min(20, mainCamera.position.z));
            });
        }
        
        function animateMain() {
            requestAnimationFrame(animateMain);
            mainRenderer.render(mainScene, mainCamera);
        }
        
        function onMainCanvasResize() {
            if (!rallyView.classList.contains('hidden') && mainCamera && mainRenderer) {
                const canvas = document.getElementById('mainRallyCanvas');
                mainCamera.aspect = canvas.clientWidth / canvas.clientHeight;
                mainCamera.updateProjectionMatrix();
                mainRenderer.setSize(canvas.clientWidth, canvas.clientHeight);
            }
        }
        
        function loadAsset(url) {
            if (typeof THREE.GLTFLoader === 'undefined') {
                alert('GLTFLoader not available. Please check the library is loaded correctly.');
                return;
            }
            
            const loader = new THREE.GLTFLoader();
            loader.load(
                url,
                (gltf) => {
                    if (mainModel) mainScene.remove(mainModel);
                    mainModel = gltf.scene;
                    
                    // Center and scale the model
                    const box = new THREE.Box3().setFromObject(mainModel);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 3 / maxDim;
                    
                    mainModel.scale.multiplyScalar(scale);
                    mainModel.position.sub(center.multiplyScalar(scale));
                    
                    mainScene.add(mainModel);
                    alert('Model loaded successfully!');
                },
                (progress) => {
                    console.log('Loading: ' + (progress.loaded / progress.total * 100) + '%');
                },
                (error) => {
                    alert('Error loading model: ' + error.message);
                    console.error(error);
                }
            );
        }
        
        // --- Header Resize Logic ---
        resizeHandle.addEventListener('mousedown', (e) => {
            e.preventDefault();
            headerResizing = true;
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
            rallyHeader.style.transition = 'none';
        });
        
        function handleMouseMove(e) {
            if (!headerResizing) return;
            const newHeight = e.clientY - rallyHeader.offsetTop;
            
            if (newHeight >= MIN_HEADER_HEIGHT && newHeight <= MAX_HEADER_HEIGHT) {
                rallyHeader.style.height = `${newHeight}px`;
            }
        }
        
        function handleMouseUp() {
            headerResizing = false;
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('mouseup', handleMouseUp);
            rallyHeader.style.transition = 'height 0.3s ease-out';
            onMainCanvasResize();
        }
        
        // --- Sidebar Toggle Logic ---
        toggleSidebar.addEventListener('click', () => {
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
                rallySidebar.classList.remove('w-0', 'min-w-0', 'p-0');
                rallySidebar.classList.add('w-1/4', 'max-w-xs', 'p-4');
                rallySidebar.querySelectorAll('div, h3, label, button, input').forEach(el => el.classList.remove('hidden'));
                toggleSidebar.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';
            } else {
                rallySidebar.classList.remove('w-1/4', 'max-w-xs', 'p-4');
                rallySidebar.classList.add('w-0', 'min-w-0', 'p-0');
                rallySidebar.querySelectorAll('div, h3, label, button, input').forEach(el => el.classList.add('hidden'));
                toggleSidebar.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>';
            }
            
            onMainCanvasResize();
        });
        
        const checkSidebarVisibility = () => {
            if (window.innerWidth >= 768) {
                sidebarOpen = true;
                rallySidebar.classList.remove('w-0', 'min-w-0', 'p-0');
                rallySidebar.classList.add('w-1/4', 'max-w-xs', 'p-4');
                rallySidebar.querySelectorAll('div, h3, label, button, input').forEach(el => el.classList.remove('hidden'));
                toggleSidebar.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';
            } else {
                sidebarOpen = false;
                rallySidebar.classList.remove('w-1/4', 'max-w-xs', 'p-4');
                rallySidebar.classList.add('w-0', 'min-w-0', 'p-0');
                rallySidebar.querySelectorAll('div, h3, label, button, input').forEach(el => el.classList.add('hidden'));
                toggleSidebar.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>';
            }
        };
        
        window.addEventListener('resize', checkSidebarVisibility);
        checkSidebarVisibility();
        
        // --- Asset Loading ---
        document.getElementById('addAssetBtn').addEventListener('click', () => {
            const url = document.getElementById('addUrl').value.trim();
            if (url) {
                loadAsset(url);
            } else {
                alert('Please enter a valid URL');
            }
        });
        
        document.getElementById('loadSampleCar').addEventListener('click', () => {
            // Create a sample car instead of loading external URL
            createPlaceholderModel();
            alert('Sample car loaded! (Placeholder model)');
        });
        
        // --- Canvas Copy Function ---
        document.getElementById('copyCanvasBtn').addEventListener('click', async () => {
            try {
                const canvas = document.getElementById('mainRallyCanvas');
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                alert('Canvas image copied to clipboard!');
            } catch (err) {
                // Fallback to data URL
                const canvas = document.getElementById('mainRallyCanvas');
                const dataURL = canvas.toDataURL('image/png');
                const textarea = document.createElement('textarea');
                textarea.value = dataURL;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Image data URL copied to clipboard!');
            }
        });
        
        // --- Reset Camera ---
        document.getElementById('resetViewBtn').addEventListener('click', () => {
            if (mainCamera && mainModel) {
                mainCamera.position.set(0, 2, 5);
                mainCamera.lookAt(0, 0, 0);
                mainModel.rotation.set(0, 0, 0);
                alert('Camera reset!');
            }
        });
        
        // --- Initialization ---
        window.onload = function() {
            initHome3D();
        }
    </script>
</body>
</html>
